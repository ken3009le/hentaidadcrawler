
<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>Crawler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- icon -->
  <link rel="icon" href="e-A69.ico" type="image/x-icon">
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: monospace;
      margin: 0;
    }

    .header-bar {
      display: flex;
      align-items: center;
      padding: 10px 14px;
      background: #111;
    }

    .popup img {
      width: auto;
      max-width: 98vw;
      max-height: 98vh;
      object-fit: contain;
      border-radius: 10px;
      box-shadow: 0 0 40px #f0f;
    }

    #tagSearch {
      flex: 1;
      padding: 8px 14px;
      background: #000;
      color: #fff;
      border: none;
      border-bottom: 1px solid #333;
      font-size: 14px;
      margin-right: 10px;
    }

    #menuIcon {
      width: 24px;
      height: 24px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    #menuIcon div {
      width: 100%;
      height: 4px;
      background: #fff;
    }

    .tag-bar {
      display: flex;
      overflow-x: auto;
      white-space: nowrap;
      background: #222;
      padding: 10px 14px;
      gap: 10px;
      scrollbar-width: none;
    }

    .tag-bar::-webkit-scrollbar {
      display: none;
    }

    .tag {
      background: #333;
      color: #fff;
      padding: 8px 16px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 14px;
      transition: 0.25s;
    }

    .tag:hover {
      background: orange;
      color: #000;
      transform: scale(1.05);
    }

    .result {
      padding: 10px;
    }

    .card {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 10px;
      margin: 10px 0;
      cursor: pointer;
      transition: 0.2s;
    }

    .card:hover {
      border-color: orange;
      box-shadow: 0 0 10px rgba(255, 165, 0, 0.3);
    }

    .card img {
      width: 100%;
      max-width: 240px;
      height: auto;
      object-fit: cover;
      border-radius: 10px;
    }

    .card-content {
      flex: 1;
      overflow-wrap: break-word;
      word-wrap: break-word;
      word-break: break-word;
      white-space: normal;
      max-width: 100%;
    }

    .card-actions {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
    }

    .open-btn:hover {
      background: orange;
      color: black;
      border-color: orange;
    }

    .view-btn {
      background: #333;
      color: #fff;
      border: 1px solid #555;
      padding: 6px 12px;
      font-size: 13px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
      min-width: 60px;
      text-align: center;
    }

    .view-btn:hover {
      background: #555;
      border-color: #777;
    }

    .card-title {
      font-weight: bold;
      color: orange;
      margin-bottom: 4px;
    }

    #tagExplorer {
      display: none;
      padding: 10px;
      background: #111;
    }

    #tagFilter {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      background: #222;
      border: 1px solid #444;
      color: #fff;
      border-radius: 6px;
    }

    .tag-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
    }

    .tag-item {
      background: #222;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
    }

    .tag-item:hover {
      background: orange;
      color: #000;
    }

    .tag-thumb {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 6px;
    }

    .gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      animation: fadeIn 0.3s ease;
    }

    .gallery img {
      width: 100%;
      max-width: calc(33.333% - 10px);
      height: auto;
      border-radius: 10px;
      cursor: zoom-in;
      transition: all 0.3s ease;
      object-fit: cover;
    }

    @media (max-width: 1024px) {
      .gallery img {
        max-width: calc(50% - 10px);
      }

      .card {
        flex-direction: column;
        text-align: center;
      }

      .card-actions {
        align-items: center;
        flex-direction: row;
        justify-content: center;
      }
    }

    @media (max-width: 600px) {
      .gallery img {
        max-width: 100%;
      }
    }

    .gallery img.expanded {
      position: fixed;
      top: 50%;
      left: 50%;
      max-width: 95vw;
      max-height: 95vh;
      width: auto;
      height: auto;
      transform: translate(-50%, -50%);
      border: 4px solid #f0f;
      border-radius: 14px;
      background: #000;
      z-index: 9999;
      box-shadow: 0 0 30px #f0f;
      cursor: zoom-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.97);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .image-zoom-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeIn 0.2s ease;
    }

    .image-zoom-overlay img {
      max-width: 96vw;
      max-height: 96vh;
      border-radius: 12px;
      box-shadow: 0 0 40px #f0f;
      transition: transform 0.3s ease;
      cursor: pointer;
    }

    .logo {
      height: 40px;
      width: auto;
      margin-right: 14px;
      border-radius: 6px;
    }
    /* /* cho tagSearch to ra */
    #tagSearch {
      flex: 1;
      padding: 8px 14px;
      background: #000;
      color: #fff;
      border: none;
      border-bottom: 1px solid #333;
      font-size: 14px;
      margin-right: 10px;
    }
  </style>
</head>

<body>
  <div class="header-bar">
    <a href="#"><img src="Archive-69.png" alt="Logo" class="logo"></a>
    <input type="text" id="tagSearch" placeholder="üîç T√¨m tag...">
    <div id="menuIcon">
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
  <audio id="bgMusic" src="music.mp3" loop preload="auto"></audio>
  <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.4"
    style="position:fixed;bottom:10px;right:10px;opacity:0.6;width:120px;">

  <div class="tag-bar" id="tagBar"><span>ƒêang t·∫£i tag...</span></div>
  <div class="result" id="result"></div>

  <div id="tagExplorer">
    <h2>üß† T·∫•t c·∫£ Tag</h2>
    <input type="text" id="tagFilter" placeholder="T√¨m tag... (·∫•n / ƒë·ªÉ focus)">
    <div class="tag-grid" id="tagGrid">ƒêang t·∫£i...</div>
  </div>
  <div class="image-zoom-overlay" id="zoomOverlay" onclick="this.style.display='none'"></div>

  <script>
    let allTags = [];

    async function fetchTags() {
      try {
        const res = await fetch('media.json');
        const data = await res.json();
        allTags = data;

        const tagBar = document.getElementById('tagBar');
        tagBar.innerHTML = '';
        data.forEach(item => {
          const span = document.createElement('span');
          span.className = 'tag';
          span.textContent = item.name;
          span.onclick = () => crawlAllPages(item.url);
          tagBar.appendChild(span);
        });

        renderTags(data);
      } catch (e) {
        document.getElementById('tagBar').innerHTML = 'L·ªói: ' + e.message;
        document.getElementById('tagGrid').innerHTML = 'L·ªói: ' + e.message;
      }
    }

    function renderTags(list) {
      const grid = document.getElementById('tagGrid');
      grid.innerHTML = '';
      list.forEach(item => {
        const div = document.createElement('div');
        div.className = 'tag-item';
        div.innerHTML = `<img src="${item.thumb || 'https://via.placeholder.com/160x120'}" class="tag-thumb"><div>${item.name}</div>`;
        div.onclick = () => crawlAllPages(item.url);
        grid.appendChild(div);
      });
    }

    function crawlAllPages(baseUrl) {
      const result = document.getElementById('result');
      result.innerHTML = `<p>ƒêang crawl: <strong>${baseUrl}</strong></p>`;
      const postMap = new Map();
      let page = 1;

      async function next() {
        const pageUrl = `${baseUrl}/${page}`;
        try {
          const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(pageUrl)}`);
          if (!res.ok) return finish();
          const html = await res.text();
          const doc = new DOMParser().parseFromString(html, 'text/html');
          const articles = [...doc.querySelectorAll('article.post')];
          if (!articles.length) return finish();

          let found = 0;
          articles.forEach(article => {
            const link = article.querySelector('a')?.href || '';
            if (!link.includes('/hentai/')) {
              const title = article.querySelector('h2 a')?.textContent.trim() || '(Kh√¥ng ti√™u ƒë·ªÅ)';
              const thumb = article.querySelector('img')?.src || '';
              if (!postMap.has(link)) {
                postMap.set(link, { title, thumb });
                found++;
              }
            }
          });

          if (found > 0) {
            page++;
            next();
          } else finish();
        } catch {
          finish();
        }
      }

      function finish() {
        if (postMap.size) {
          result.innerHTML += [...postMap.entries()].map(([url, post]) => `
          <div class="card">
            <img src="${post.thumb}" alt="thumb" loading="lazy">
            <div class="card-content">
              <div class="card-title">${post.title}</div>
              <div style="color:#888;font-size:12px">${url}</div>
            </div>
            <div class="card-actions">
              <button class="open-btn" onclick="event.stopPropagation(); window.open('${url.replace(/'/g, "\\'")}', '_blank')">üîó Open</button>
              <button class="view-btn" onclick="loadGallery('${url.replace(/'/g, "\\'")}')">üëÅÔ∏è View</button>
            </div>
          </div>
        `).join('');
        } else {
          result.innerHTML += `<p style="color:orange">Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt n√†o.</p>`;
        }
      }

      next();
    }

    async function loadGallery(postUrl) {
      try {
        const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(postUrl)}`);
        const html = await res.text();
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const gallery = doc.querySelectorAll('#lightgallery a[href$=".webp"]');
        if (!gallery.length) return alert('Kh√¥ng t√¨m th·∫•y ·∫£nh!');

        const container = document.createElement('div');
        container.className = 'gallery';

        gallery.forEach(link => {
          const img = document.createElement('img');
          img.src = link.href;
          img.loading = 'lazy';
          img.onclick = () => {
            const overlay = document.getElementById('zoomOverlay');
            overlay.innerHTML = '';
            const zoomed = document.createElement('img');
            zoomed.src = img.src;
            overlay.appendChild(zoomed);
            overlay.style.display = 'flex';
          };
          container.appendChild(img);
        });

        const cards = document.querySelectorAll('.card');
        cards.forEach(card => {
          const cardContent = card.querySelector('.card-content');
          if (cardContent && cardContent.innerText.includes(postUrl) && !card.nextElementSibling?.classList.contains('gallery')) {
            card.insertAdjacentElement('afterend', container);
          }
        });
      } catch (e) {
        alert('L·ªói ·∫£nh: ' + e.message);
      }
    }

    document.getElementById('tagSearch').addEventListener('input', function () {
      const kw = this.value.toLowerCase();
      const filtered = allTags.filter(tag => tag.name.toLowerCase().includes(kw));
      const tagBar = document.getElementById('tagBar');
      tagBar.innerHTML = '';
      filtered.forEach(item => {
        const span = document.createElement('span');
        span.className = 'tag';
        span.textContent = item.name;
        span.onclick = () => crawlAllPages(item.url);
        tagBar.appendChild(span);
      });
    });

    document.getElementById('tagFilter').addEventListener('input', function () {
      const kw = this.value.toLowerCase();
      renderTags(allTags.filter(tag => tag.name.toLowerCase().includes(kw)));
    });

    document.getElementById('menuIcon').addEventListener('click', () => {
      const tagBar = document.getElementById('tagBar');
      const tagExplorer = document.getElementById('tagExplorer');
      const isExplorerShown = tagExplorer.style.display === 'block';
      if (isExplorerShown) {
        tagExplorer.style.display = 'none';
        tagBar.style.display = 'flex';
      } else {
        tagExplorer.style.display = 'block';
        tagBar.style.display = 'none';
      }
    });

    document.addEventListener('keydown', function (e) {
      if (e.key.toLowerCase() === 'r') {
        document.getElementById('result').innerHTML = '';
        document.querySelectorAll('.gallery').forEach(g => g.remove());
        console.log('[X.SYNTH] ƒê√£ x√≥a to√†n b·ªô d·∫•u v·∫øt. Ch·ªâ c√≤n tag + search.');
      }

      if (e.key === '/' && !['tagSearch', 'tagFilter'].includes(document.activeElement.id)) {
        e.preventDefault();
        const explorer = document.getElementById('tagExplorer');
        (explorer.style.display === 'block' ? tagFilter : tagSearch).focus();
      }
    });

    window.addEventListener('DOMContentLoaded', () => {
      const tagUrl = new URLSearchParams(window.location.search).get('tag');
      if (tagUrl) crawlAllPages(tagUrl);
      fetchTags();
    });

    const music = document.getElementById('bgMusic');
    const volumeSlider = document.getElementById('volumeSlider');

    music.volume = 0.4; // m·∫∑c ƒë·ªãnh 40%
    volumeSlider.value = 0.4;

    let isPlaying = false;

    // B·∫≠t/t·∫Øt nh·∫°c b·∫±ng ph√≠m M
    document.addEventListener('keydown', function (e) {
      if (e.key.toLowerCase() === 'm') {
        isPlaying ? music.pause() : music.play();
        isPlaying = !isPlaying;
        console.log(`[X.SYNTH] Nh·∫°c ${isPlaying ? 'ƒëang ph√°t' : 't·∫°m d·ª´ng'}.`);
      }

      if (e.key.toLowerCase() === 'r') {
        document.getElementById('result').innerHTML = '';
        document.querySelectorAll('.gallery').forEach(g => g.remove());
        console.log('[X.SYNTH] ƒê√£ x√≥a to√†n b·ªô d·∫•u v·∫øt. Ch·ªâ c√≤n tag + search.');
      }

      if (e.key === '/' && !['tagSearch', 'tagFilter'].includes(document.activeElement.id)) {
        e.preventDefault();
        const explorer = document.getElementById('tagExplorer');
        (explorer.style.display === 'block' ? tagFilter : tagSearch).focus();
      }
    });

    // C·∫≠p nh·∫≠t volume theo slider
    volumeSlider.addEventListener('input', function () {
      music.volume = parseFloat(this.value);
      console.log(`[X.SYNTH] Volume: ${Math.round(music.volume * 100)}%`);
    });

  </script>
</body>

</html>
